<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>XiXi Chat</title>
<style>
  :root {
    --accent: #ff00aa;
    --bg: #111;
    --text: #fff;
  }
  * {box-sizing:border-box;margin:0;padding:0;font-family:sans-serif;}
  body {background:var(--bg);color:var(--text);height:100vh;display:flex;flex-direction:column;justify-content:center;align-items:center;}
  #chatContainer {display:flex;flex-direction:column;width:100%;max-width:500px;height:80vh;background:#000;border-radius:12px;overflow:hidden;}
  #chatHeader {background:#111;height:60px;display:flex;justify-content:center;align-items:center;font-size:1.5em;font-weight:bold;color:var(--accent);}
  #messages {flex:1;padding:12px;overflow-y:auto;display:flex;flex-direction:column;gap:8px;}
  .msg {padding:8px 12px;background:#222;border-radius:8px;max-width:80%;}
  .msg.me {background:var(--accent);color:#000;align-self:flex-end;}
  #inputBar {display:flex;border-top:1px solid #333;}
  #inputBar input {flex:1;padding:12px;background:#111;border:none;color:#fff;}
  #inputBar button {padding:12px;background:var(--accent);border:none;color:#000;font-weight:bold;cursor:pointer;}
  /* Auth Modal */
  #authModal {position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.85);display:flex;justify-content:center;align-items:center;z-index:10000;}
  #authModal div {background:#111;padding:24px;border-radius:12px;width:300px;display:flex;flex-direction:column;gap:12px;}
  #authModal input {padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.1);background:#000;color:#fff;}
  #authModal button {padding:10px;background:var(--accent);border:none;color:#000;font-weight:bold;cursor:pointer;border-radius:8px;}
</style>
</head>
<body>

<!-- CHAT CONTAINER -->
<div id="chatContainer">
  <div id="chatHeader">XiXi</div>
  <div id="messages"></div>
  <div id="inputBar">
    <input type="text" id="messageInput" placeholder="Type a message...">
    <button id="sendBtn">Send</button>
  </div>
</div>

<!-- SIGNUP / LOGIN MODAL -->
<div id="authModal">
  <div>
    <h2 style="text-align:center;color:var(--accent)">Welcome to XiXi</h2>
    <input type="email" id="emailInput" placeholder="Email">
    <input type="password" id="passwordInput" placeholder="Password">
    <button id="loginBtn">Login</button>
    <button id="signupBtn">Sign Up</button>
    <button id="guestBtn">Continue as Guest</button>
  </div>
</div>

<!-- FIREBASE SDK -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.6.2/firebase-app.js";
import { getDatabase, ref, push, onChildAdded } from "https://www.gstatic.com/firebasejs/10.6.2/firebase-database.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.6.2/firebase-auth.js";

// FIREBASE CONFIG
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_DOMAIN",
  databaseURL: "YOUR_DB_URL",
  projectId: "YOUR_PROJECT_ID",
  storageBucket: "YOUR_BUCKET",
  messagingSenderId: "YOUR_SENDER",
  appId: "YOUR_APP_ID"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const auth = getAuth(app);

// AUTH ELEMENTS
const authModal = document.getElementById('authModal');
const emailInput = document.getElementById('emailInput');
const passwordInput = document.getElementById('passwordInput');
const loginBtn = document.getElementById('loginBtn');
const signupBtn = document.getElementById('signupBtn');
const guestBtn = document.getElementById('guestBtn');

let username = "Guest";

signupBtn.addEventListener('click', async()=>{
  try{
    const userCred = await createUserWithEmailAndPassword(auth, emailInput.value, passwordInput.value);
    username = userCred.user.email;
    authModal.style.display='none';
  }catch(e){alert(e.message);}
});

loginBtn.addEventListener('click', async()=>{
  try{
    const userCred = await signInWithEmailAndPassword(auth, emailInput.value, passwordInput.value);
    username = userCred.user.email;
    authModal.style.display='none';
  }catch(e){alert(e.message);}
});

guestBtn.addEventListener('click', ()=>{
  username = "Guest";
  authModal.style.display='none';
});

// CHAT ELEMENTS
const messagesDiv = document.getElementById('messages');
const messageInput = document.getElementById('messageInput');
const sendBtn = document.getElementById('sendBtn');

sendBtn.addEventListener('click', sendMessage);
messageInput.addEventListener('keypress', e => {if(e.key==='Enter') sendMessage();});

function sendMessage(){
  if(messageInput.value.trim()==="") return;
  push(ref(db, 'messages'), {user: username, text: messageInput.value});
  messageInput.value='';
}

onChildAdded(ref(db, 'messages'), snapshot=>{
  const msg = snapshot.val();
  const div = document.createElement('div');
  div.classList.add('msg');
  if(msg.user === username) div.classList.add('me');
  div.textContent = msg.user + ": " + msg.text;
  messagesDiv.appendChild(div);
  messagesDiv.scrollTop = messagesDiv.scrollHeight;
});
</script>

</body>
</html>
